<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turni 4¬™ Squadra 2026 - ULTRA</title>
    <meta name="description" content="Gestione turni avanzata con sincronizzazione, condivisione e analisi">
    <meta name="theme-color" content="#1f2937">
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiVHVybmkgNMKqIFNxdWFkcmEgMjAyNiIsInNob3J0X25hbWUiOiJUdXJuaSAyMDI2IiwiZGVzY3JpcHRpb24iOiJHZXN0aW9uZSB0dXJuaSBhdmFuemF0YSIsInN0YXJ0X3VybCI6Ii4iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMWYyOTM3IiwidGhlbWVfY29sb3IiOiIjMWYyOTM3IiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbCw8c3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnPjx0ZXh0IHk9Jy45ZW0nIGZvbnQtc2l6ZT0nOTAnPvCfk4U8L3RleHQ+PC9zdmc+Iiwic2l6ZXMiOiJhbnkiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .turno-mat { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        .turno-pom { background: linear-gradient(135deg, #60a5fa, #3b82f6); }
        .turno-not { background: linear-gradient(135deg, #a78bfa, #8b5cf6); }
        .turno-riposo { background: linear-gradient(135deg, #34d399, #10b981); }
        .turno-ferie { background: linear-gradient(135deg, #f472b6, #ec4899); }
        .turno-permesso { background: linear-gradient(135deg, #fcd34d, #fbbf24); }
        .turno-malattia { background: linear-gradient(135deg, #f87171, #ef4444); }
        .turno-straordinario { background: linear-gradient(135deg, #fb923c, #f97316); }
        .turno-formazione { background: linear-gradient(135deg, #06b6d4, #0891b2); }
        .turno-trasferta { background: linear-gradient(135deg, #14b8a6, #0d9488); }
        .modal-backdrop { background: rgba(0,0,0,0.8); backdrop-filter: blur(8px); }
        .glass { background: rgba(255,255,255,0.1); backdrop-filter: blur(10px); border: 1px solid rgba(255,255,255,0.2); }
        .glow { box-shadow: 0 0 20px rgba(59, 130, 246, 0.5); }
        .pulse-dot { animation: pulse-dot 2s infinite; }
        @keyframes pulse-dot { 0%, 100% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.5); opacity: 0.5; } }
        .slide-in { animation: slideIn 0.3s ease-out; }
        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
        .confetti { position: fixed; pointer-events: none; z-index: 9999; }
        @keyframes fall { to { transform: translateY(100vh) rotate(720deg); } }
        .countdown { font-variant-numeric: tabular-nums; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #4b5563; border-radius: 4px; }
        .drag-over { border: 3px dashed #60a5fa !important; }
    </style>
</head>
<body class="bg-gray-900">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useRef, useCallback } = React;

        function App() {
            // Core State
            const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());
            const [hoveredDay, setHoveredDay] = useState(null);
            const [modifiche, setModifiche] = useState(() => JSON.parse(localStorage.getItem('turni-mod-2026') || '{}'));
            const [note, setNote] = useState(() => JSON.parse(localStorage.getItem('turni-note-2026') || '{}'));
            const [showModal, setShowModal] = useState(false);
            const [selectedDay, setSelectedDay] = useState(null);
            const [modalNote, setModalNote] = useState('');
            
            // Advanced Features State
            const [userName, setUserName] = useState(() => localStorage.getItem('turni-user') || '');
            const [showWelcome, setShowWelcome] = useState(() => !localStorage.getItem('turni-user'));
            const [shareCode, setShareCode] = useState('');
            const [importCode, setImportCode] = useState('');
            const [showShareModal, setShowShareModal] = useState(false);
            const [showChartModal, setShowChartModal] = useState(false);
            const [showTimelineModal, setShowTimelineModal] = useState(false);
            const [showCompareModal, setShowCompareModal] = useState(false);
            const [notification, setNotification] = useState(null);
            const [searchDate, setSearchDate] = useState('');
            const [darkMode, setDarkMode] = useState(true);
            const [viewMode, setViewMode] = useState('calendar'); // calendar, list, timeline
            const [selectedRange, setSelectedRange] = useState({ start: null, end: null });
            const [isSelecting, setIsSelecting] = useState(false);
            const [showBulkModal, setShowBulkModal] = useState(false);
            const [countdown, setCountdown] = useState(null);
            const [showCountdownModal, setShowCountdownModal] = useState(false);
            const [countdownTarget, setCountdownTarget] = useState('');
            const [weather, setWeather] = useState(null);
            const [showPrintPreview, setShowPrintPreview] = useState(false);
            const [colleagues, setColleagues] = useState(() => JSON.parse(localStorage.getItem('turni-colleagues') || '[]'));
            const [showColleagueModal, setShowColleagueModal] = useState(false);
            const [newColleague, setNewColleague] = useState({ name: '', offset: 0 });
            const [achievements, setAchievements] = useState(() => JSON.parse(localStorage.getItem('turni-achievements') || '[]'));
            const [showAchievements, setShowAchievements] = useState(false);
            const [draggedDay, setDraggedDay] = useState(null);
            const [showQuickStats, setShowQuickStats] = useState(true);
            const [showMiniCalendar, setShowMiniCalendar] = useState(false);
            const [reminderDays, setReminderDays] = useState(() => JSON.parse(localStorage.getItem('turni-reminders') || '[]'));
            const [showReminderModal, setShowReminderModal] = useState(false);
            const [currentReminder, setCurrentReminder] = useState('');
            const [filterType, setFilterType] = useState('all');
            const [showBackupModal, setShowBackupModal] = useState(false);
            const [backupHistory, setBackupHistory] = useState(() => JSON.parse(localStorage.getItem('turni-backups') || '[]'));
            
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            const mesi = ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"];
            const giorniMese = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            const giorniSettimana = ["Lun", "Mar", "Mer", "Gio", "Ven", "Sab", "Dom"];
            const primoGiornoMese = [3, 6, 6, 2, 4, 0, 2, 5, 1, 3, 6, 1];

            const tipiModifica = [
                { id: 'ferie', nome: 'Ferie', emoji: 'üèñÔ∏è', classe: 'turno-ferie', color: '#ec4899' },
                { id: 'permesso', nome: 'Permesso', emoji: 'üìã', classe: 'turno-permesso', color: '#fbbf24' },
                { id: 'malattia', nome: 'Malattia', emoji: 'ü§í', classe: 'turno-malattia', color: '#ef4444' },
                { id: 'straordinario', nome: 'Straordinario', emoji: '‚ö°', classe: 'turno-straordinario', color: '#f97316' },
                { id: 'formazione', nome: 'Formazione', emoji: 'üìö', classe: 'turno-formazione', color: '#0891b2' },
                { id: 'trasferta', nome: 'Trasferta', emoji: '‚úàÔ∏è', classe: 'turno-trasferta', color: '#0d9488' },
            ];

            const ciclo = [
                { tipo: "Pom", orario: "14:00-22:00", lavoro: true, ore: 8 },
                { tipo: "Pom", orario: "14:00-22:00", lavoro: true, ore: 8 },
                { tipo: "Pom", orario: "14:00-22:00", lavoro: true, ore: 8 },
                { tipo: "R", orario: "Riposo", lavoro: false, ore: 0 },
                { tipo: "Mat", orario: "06:00-14:00", lavoro: true, ore: 8 },
                { tipo: "Mat", orario: "06:00-14:00", lavoro: true, ore: 8 },
                { tipo: "Mat", orario: "06:00-14:00", lavoro: true, ore: 8 },
                { tipo: "R", orario: "Riposo", lavoro: false, ore: 0 },
                { tipo: "Not", orario: "22:00-06:00", lavoro: true, ore: 8 },
                { tipo: "Not", orario: "22:00-06:00", lavoro: true, ore: 8 },
                { tipo: "Not", orario: "22:00-06:00", lavoro: true, ore: 8 },
                { tipo: "R", orario: "Riposo", lavoro: false, ore: 0 },
            ];

            // Save to localStorage
            useEffect(() => { localStorage.setItem('turni-mod-2026', JSON.stringify(modifiche)); }, [modifiche]);
            useEffect(() => { localStorage.setItem('turni-note-2026', JSON.stringify(note)); }, [note]);
            useEffect(() => { localStorage.setItem('turni-user', userName); }, [userName]);
            useEffect(() => { localStorage.setItem('turni-colleagues', JSON.stringify(colleagues)); }, [colleagues]);
            useEffect(() => { localStorage.setItem('turni-achievements', JSON.stringify(achievements)); }, [achievements]);
            useEffect(() => { localStorage.setItem('turni-reminders', JSON.stringify(reminderDays)); }, [reminderDays]);
            useEffect(() => { localStorage.setItem('turni-backups', JSON.stringify(backupHistory)); }, [backupHistory]);

            // Countdown timer
            useEffect(() => {
                if (!countdownTarget) return;
                const timer = setInterval(() => {
                    const now = new Date();
                    const target = new Date(countdownTarget);
                    const diff = target - now;
                    if (diff <= 0) {
                        setCountdown(null);
                        clearInterval(timer);
                        showNotification('üéâ Countdown terminato!');
                        createConfetti();
                    } else {
                        const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                        const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                        const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
                        const seconds = Math.floor((diff % (1000 * 60)) / 1000);
                        setCountdown({ days, hours, minutes, seconds });
                    }
                }, 1000);
                return () => clearInterval(timer);
            }, [countdownTarget]);

            // Check achievements
            useEffect(() => {
                const stats = calcolaStatistiche();
                const newAchievements = [];
                
                if (stats.ferie >= 10 && !achievements.includes('vacanziero')) {
                    newAchievements.push('vacanziero');
                    showNotification('üèÜ Achievement: Vacanziero! (10+ ferie)');
                }
                if (stats.straordinario >= 20 && !achievements.includes('stakanovista')) {
                    newAchievements.push('stakanovista');
                    showNotification('üèÜ Achievement: Stakanovista! (20+ straordinari)');
                }
                if (Object.keys(note).length >= 50 && !achievements.includes('organizzato')) {
                    newAchievements.push('organizzato');
                    showNotification('üèÜ Achievement: Super Organizzato! (50+ note)');
                }
                if (stats.Not >= 30 && !achievements.includes('nottambulo')) {
                    newAchievements.push('nottambulo');
                    showNotification('üèÜ Achievement: Nottambulo! (30+ notti)');
                }
                
                if (newAchievements.length > 0) {
                    setAchievements([...achievements, ...newAchievements]);
                    createConfetti();
                }
            }, [modifiche, note]);

            const createConfetti = () => {
                const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#dda0dd'];
                for (let i = 0; i < 50; i++) {
                    const confetti = document.createElement('div');
                    confetti.className = 'confetti';
                    confetti.style.left = Math.random() * 100 + 'vw';
                    confetti.style.top = '-10px';
                    confetti.style.width = '10px';
                    confetti.style.height = '10px';
                    confetti.style.background = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.animation = `fall ${2 + Math.random() * 3}s linear forwards`;
                    document.body.appendChild(confetti);
                    setTimeout(() => confetti.remove(), 5000);
                }
            };

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 4000);
            };

            const getTurnoBase = (meseIdx, giorno, offset = 0) => {
                let giornoAnno = giorno;
                for (let i = 0; i < meseIdx; i++) giornoAnno += giorniMese[i];
                const indiceCiclo = (giornoAnno - 1 + 3 + offset) % 12;
                return ciclo[indiceCiclo];
            };

            const getChiaveGiorno = (meseIdx, giorno) => `${meseIdx}-${giorno}`;

            const getTurnoEffettivo = (meseIdx, giorno) => {
                const chiave = getChiaveGiorno(meseIdx, giorno);
                const modifica = modifiche[chiave];
                if (modifica) return { ...getTurnoBase(meseIdx, giorno), modifica };
                return getTurnoBase(meseIdx, giorno);
            };

            const getTurnoClass = (turno) => {
                if (turno.modifica) {
                    const tipo = tipiModifica.find(t => t.id === turno.modifica.tipo);
                    return tipo ? `${tipo.classe} text-white` : 'bg-gray-500 text-white';
                }
                switch(turno.tipo) {
                    case "Mat": return "turno-mat text-white";
                    case "Pom": return "turno-pom text-white";
                    case "Not": return "turno-not text-white";
                    case "R": return "turno-riposo text-white";
                    default: return "bg-gray-200";
                }
            };

            const apriModale = (meseIdx, giorno) => {
                if (isSelecting) {
                    if (!selectedRange.start) {
                        setSelectedRange({ start: { mese: meseIdx, giorno }, end: null });
                    } else if (!selectedRange.end) {
                        setSelectedRange({ ...selectedRange, end: { mese: meseIdx, giorno } });
                        setShowBulkModal(true);
                        setIsSelecting(false);
                    }
                } else {
                    setSelectedDay({ mese: meseIdx, giorno });
                    const chiave = getChiaveGiorno(meseIdx, giorno);
                    setModalNote(note[chiave] || '');
                    setCurrentReminder(reminderDays.find(r => r.key === chiave)?.text || '');
                    setShowModal(true);
                }
            };

            const applicaModifica = (tipoModifica) => {
                if (!selectedDay) return;
                const chiave = getChiaveGiorno(selectedDay.mese, selectedDay.giorno);
                
                if (tipoModifica === 'reset') {
                    const nuoveModifiche = { ...modifiche };
                    delete nuoveModifiche[chiave];
                    setModifiche(nuoveModifiche);
                    showNotification('üîÑ Turno ripristinato!');
                } else {
                    setModifiche({ ...modifiche, [chiave]: { tipo: tipoModifica, data: new Date().toISOString() } });
                    const tipo = tipiModifica.find(t => t.id === tipoModifica);
                    showNotification(`${tipo.emoji} ${tipo.nome} applicato!`);
                }
            };

            const applicaModificaBulk = (tipoModifica) => {
                if (!selectedRange.start || !selectedRange.end) return;
                const nuoveModifiche = { ...modifiche };
                
                let startDay = selectedRange.start.mese * 100 + selectedRange.start.giorno;
                let endDay = selectedRange.end.mese * 100 + selectedRange.end.giorno;
                if (startDay > endDay) [startDay, endDay] = [endDay, startDay];
                
                let count = 0;
                for (let m = 0; m < 12; m++) {
                    for (let g = 1; g <= giorniMese[m]; g++) {
                        const dayNum = m * 100 + g;
                        if (dayNum >= startDay && dayNum <= endDay) {
                            const chiave = getChiaveGiorno(m, g);
                            if (tipoModifica === 'reset') {
                                delete nuoveModifiche[chiave];
                            } else {
                                nuoveModifiche[chiave] = { tipo: tipoModifica, data: new Date().toISOString() };
                            }
                            count++;
                        }
                    }
                }
                
                setModifiche(nuoveModifiche);
                setSelectedRange({ start: null, end: null });
                setShowBulkModal(false);
                showNotification(`‚úÖ Modificati ${count} giorni!`);
            };

            const salvaNote = () => {
                if (!selectedDay) return;
                const chiave = getChiaveGiorno(selectedDay.mese, selectedDay.giorno);
                if (modalNote.trim()) {
                    setNote({ ...note, [chiave]: modalNote });
                    showNotification('üìù Nota salvata!');
                } else {
                    const nuoveNote = { ...note };
                    delete nuoveNote[chiave];
                    setNote(nuoveNote);
                }
            };

            const salvaReminder = () => {
                if (!selectedDay) return;
                const chiave = getChiaveGiorno(selectedDay.mese, selectedDay.giorno);
                if (currentReminder.trim()) {
                    const newReminders = reminderDays.filter(r => r.key !== chiave);
                    newReminders.push({ key: chiave, text: currentReminder, mese: selectedDay.mese, giorno: selectedDay.giorno });
                    setReminderDays(newReminders);
                    showNotification('‚è∞ Promemoria salvato!');
                }
            };

            const calcolaStatistiche = () => {
                let stats = { Mat: 0, Pom: 0, Not: 0, R: 0, totale: 0, oreStimate: 0, ferie: 0, permesso: 0, malattia: 0, straordinario: 0, formazione: 0, trasferta: 0 };
                for (let m = 0; m < 12; m++) {
                    for (let g = 1; g <= giorniMese[m]; g++) {
                        const turno = getTurnoEffettivo(m, g);
                        if (turno.modifica) {
                            stats[turno.modifica.tipo]++;
                            if (turno.modifica.tipo === 'straordinario') stats.oreStimate += 8;
                        } else {
                            stats[turno.tipo]++;
                            if (turno.lavoro) {
                                stats.totale++;
                                stats.oreStimate += 8;
                            }
                        }
                    }
                }
                return stats;
            };

            const calcolaStatisticheMensili = () => {
                const mensili = [];
                for (let m = 0; m < 12; m++) {
                    let mese = { Mat: 0, Pom: 0, Not: 0, R: 0, modifiche: 0 };
                    for (let g = 1; g <= giorniMese[m]; g++) {
                        const turno = getTurnoEffettivo(m, g);
                        if (turno.modifica) mese.modifiche++;
                        else mese[turno.tipo]++;
                    }
                    mensili.push(mese);
                }
                return mensili;
            };

            const generateShareCode = () => {
                const data = { m: modifiche, n: note, u: userName, t: Date.now() };
                const code = btoa(JSON.stringify(data));
                setShareCode(code);
                navigator.clipboard.writeText(code);
                showNotification('üìã Codice copiato negli appunti!');
            };

            const importFromCode = () => {
                try {
                    const data = JSON.parse(atob(importCode));
                    setModifiche(data.m || {});
                    setNote(data.n || {});
                    showNotification(`‚úÖ Importato da ${data.u || 'utente sconosciuto'}!`);
                    setImportCode('');
                    setShowShareModal(false);
                } catch (e) {
                    showNotification('‚ùå Codice non valido!', 'error');
                }
            };

            const createBackup = () => {
                const backup = {
                    id: Date.now(),
                    date: new Date().toISOString(),
                    modifiche: { ...modifiche },
                    note: { ...note },
                    label: `Backup ${new Date().toLocaleDateString('it-IT')}`
                };
                setBackupHistory([backup, ...backupHistory.slice(0, 9)]);
                showNotification('üíæ Backup creato!');
            };

            const restoreBackup = (backup) => {
                setModifiche(backup.modifiche);
                setNote(backup.note);
                showNotification('üîÑ Backup ripristinato!');
                setShowBackupModal(false);
            };

            const addColleague = () => {
                if (newColleague.name.trim()) {
                    setColleagues([...colleagues, { ...newColleague, id: Date.now() }]);
                    setNewColleague({ name: '', offset: 0 });
                    showNotification('üë• Collega aggiunto!');
                }
            };

            const exportToPDF = async () => {
                setShowPrintPreview(true);
                setTimeout(async () => {
                    const element = document.getElementById('print-area');
                    const canvas = await html2canvas(element, { scale: 2 });
                    const link = document.createElement('a');
                    link.download = `turni-${mesi[selectedMonth]}-2026.png`;
                    link.href = canvas.toDataURL();
                    link.click();
                    setShowPrintPreview(false);
                    showNotification('üì∏ Screenshot salvato!');
                }, 500);
            };

            const getGiornoSettimana = (meseIdx, giorno) => {
                const primo = primoGiornoMese[meseIdx];
                const idx = (primo + giorno - 1) % 7;
                return giorniSettimana[idx];
            };

            const getTodayInfo = () => {
                const today = new Date();
                if (today.getFullYear() !== 2026) return null;
                const m = today.getMonth();
                const g = today.getDate();
                return { mese: m, giorno: g, turno: getTurnoEffettivo(m, g) };
            };

            const getNextWorkDay = () => {
                const today = new Date();
                if (today.getFullYear() !== 2026) return null;
                let m = today.getMonth();
                let g = today.getDate();
                
                for (let i = 0; i < 30; i++) {
                    g++;
                    if (g > giorniMese[m]) { g = 1; m++; if (m > 11) return null; }
                    const turno = getTurnoEffettivo(m, g);
                    if (turno.lavoro && !turno.modifica) return { mese: m, giorno: g, turno };
                }
                return null;
            };

            const stats = calcolaStatistiche();
            const todayInfo = getTodayInfo();
            const nextWork = getNextWorkDay();

            const renderCalendario = () => {
                const giorni = [];
                const primoGiorno = primoGiornoMese[selectedMonth];
                const numGiorni = giorniMese[selectedMonth];

                for (let i = 0; i < primoGiorno; i++) {
                    giorni.push(<div key={`empty-${i}`} className="h-20 md:h-24"></div>);
                }

                for (let giorno = 1; giorno <= numGiorni; giorno++) {
                    const turno = getTurnoEffettivo(selectedMonth, giorno);
                    const chiave = getChiaveGiorno(selectedMonth, giorno);
                    const hasNote = note[chiave];
                    const hasModifica = turno.modifica;
                    const isHovered = hoveredDay === giorno;
                    const isToday = todayInfo && todayInfo.mese === selectedMonth && todayInfo.giorno === giorno;
                    const hasReminder = reminderDays.some(r => r.key === chiave);
                    const isInRange = selectedRange.start && (
                        (selectedRange.start.mese === selectedMonth && selectedRange.start.giorno === giorno) ||
                        (selectedRange.end && selectedRange.end.mese === selectedMonth && selectedRange.end.giorno === giorno)
                    );

                    // Filter check
                    if (filterType !== 'all') {
                        if (filterType === 'modifiche' && !hasModifica) return null;
                        if (filterType === 'note' && !hasNote) return null;
                        if (filterType === 'lavoro' && !turno.lavoro) return null;
                        if (filterType === 'riposo' && turno.tipo !== 'R') return null;
                    }
                    
                    giorni.push(
                        <div
                            key={giorno}
                            onClick={() => apriModale(selectedMonth, giorno)}
                            draggable
                            onDragStart={() => setDraggedDay({ mese: selectedMonth, giorno })}
                            onDragOver={(e) => e.preventDefault()}
                            onDrop={() => {
                                if (draggedDay) {
                                    const fromKey = getChiaveGiorno(draggedDay.mese, draggedDay.giorno);
                                    const toKey = chiave;
                                    const temp = modifiche[fromKey];
                                    const newMod = { ...modifiche };
                                    if (modifiche[toKey]) newMod[fromKey] = modifiche[toKey];
                                    else delete newMod[fromKey];
                                    if (temp) newMod[toKey] = temp;
                                    else delete newMod[toKey];
                                    setModifiche(newMod);
                                    showNotification('üîÑ Turni scambiati!');
                                }
                                setDraggedDay(null);
                            }}
                            className={`h-20 md:h-24 rounded-lg ${getTurnoClass(turno)} 
                                       flex flex-col items-center justify-center cursor-pointer relative
                                       transform transition-all duration-200 hover:scale-105 hover:shadow-xl
                                       ${isHovered ? 'ring-4 ring-white ring-opacity-70 scale-110' : ''}
                                       ${hasModifica ? 'ring-2 ring-yellow-300' : ''}
                                       ${isToday ? 'glow ring-4 ring-blue-400' : ''}
                                       ${isInRange ? 'ring-4 ring-pink-400' : ''}
                                       ${isSelecting ? 'cursor-crosshair' : ''}`}
                        >
                            {hasNote && <div className="absolute top-1 right-1 text-xs">üìù</div>}
                            {hasModifica && <div className="absolute top-1 left-1 text-xs">{tipiModifica.find(t => t.id === hasModifica.tipo)?.emoji}</div>}
                            {hasReminder && <div className="absolute bottom-1 right-1 text-xs pulse-dot">‚è∞</div>}
                            {isToday && <div className="absolute top-1 left-1/2 -translate-x-1/2 text-xs bg-blue-600 px-1 rounded">OGGI</div>}
                            <span className="text-lg font-bold">{giorno}</span>
                            <span className="text-sm font-semibold">
                                {hasModifica ? tipiModifica.find(t => t.id === hasModifica.tipo)?.nome.substring(0, 3) : turno.tipo}
                            </span>
                            {isHovered && (
                                <span className="text-xs mt-1 opacity-90 text-center px-1">
                                    {hasModifica ? tipiModifica.find(t => t.id === hasModifica.tipo)?.nome : turno.orario}
                                </span>
                            )}
                        </div>
                    );
                }

                return giorni.filter(Boolean);
            };

            const renderChart = () => {
                if (!showChartModal) return null;
                
                setTimeout(() => {
                    if (chartInstance.current) chartInstance.current.destroy();
                    const ctx = chartRef.current?.getContext('2d');
                    if (!ctx) return;

                    const mensili = calcolaStatisticheMensili();
                    chartInstance.current = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: mesi.map(m => m.substring(0, 3)),
                            datasets: [
                                { label: 'Mattina', data: mensili.map(m => m.Mat), backgroundColor: '#f59e0b' },
                                { label: 'Pomeriggio', data: mensili.map(m => m.Pom), backgroundColor: '#3b82f6' },
                                { label: 'Notte', data: mensili.map(m => m.Not), backgroundColor: '#8b5cf6' },
                                { label: 'Riposo', data: mensili.map(m => m.R), backgroundColor: '#10b981' },
                            ]
                        },
                        options: {
                            responsive: true,
                            scales: { x: { stacked: true }, y: { stacked: true } },
                            plugins: { legend: { position: 'top' } }
                        }
                    });
                }, 100);
            };

            // Welcome screen for first time users
            if (showWelcome) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-gray-900 to-gray-800 flex items-center justify-center p-4">
                        <div className="bg-gray-800 rounded-2xl p-8 max-w-md w-full shadow-2xl slide-in">
                            <h1 className="text-3xl font-bold text-white mb-4 text-center">üóìÔ∏è Benvenuto!</h1>
                            <p className="text-gray-400 mb-6 text-center">Inserisci il tuo nome per personalizzare l'app</p>
                            <input
                                type="text"
                                value={userName}
                                onChange={(e) => setUserName(e.target.value)}
                                className="w-full px-4 py-3 bg-gray-700 text-white rounded-lg mb-4 focus:ring-2 focus:ring-blue-500"
                                placeholder="Il tuo nome..."
                            />
                            <button
                                onClick={() => { if (userName.trim()) setShowWelcome(false); }}
                                className="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg font-semibold transition-colors"
                            >
                                üöÄ Inizia!
                            </button>
                        </div>
                    </div>
                );
            }

            return (
                <div className={`min-h-screen ${darkMode ? 'bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900' : 'bg-gradient-to-br from-blue-50 to-indigo-100'} p-4 md:p-6 transition-colors duration-500`}>
                    {notification && (
                        <div className={`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg slide-in ${notification.type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white font-semibold`}>
                            {notification.message}
                        </div>
                    )}

                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="text-center mb-6">
                            <h1 className={`text-3xl md:text-5xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'} mb-2`}>
                                üóìÔ∏è Turni 4¬™ Squadra 2026
                                <span className="text-xs ml-2 bg-gradient-to-r from-yellow-400 to-orange-500 text-black px-2 py-1 rounded-full font-black">ULTRA</span>
                            </h1>
                            <p className={`${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                Ciao <span className="font-semibold text-blue-400">{userName}</span>! 
                                {todayInfo && ` Oggi: ${todayInfo.turno.tipo} (${todayInfo.turno.orario})`}
                            </p>
                            {countdown && (
                                <div className="mt-2 text-2xl font-mono countdown text-yellow-400">
                                    ‚è∞ {countdown.days}g {countdown.hours}h {countdown.minutes}m {countdown.seconds}s
                                </div>
                            )}
                        </div>

                        {/* Quick Stats Bar */}
                        {showQuickStats && (
                            <div className="glass rounded-xl p-3 mb-4 flex flex-wrap gap-2 justify-center items-center">
                                <span className="text-white text-sm">üíº {stats.totale} giorni</span>
                                <span className="text-white text-sm">|</span>
                                <span className="text-white text-sm">‚è∞ {stats.oreStimate}h</span>
                                <span className="text-white text-sm">|</span>
                                <span className="text-white text-sm">üèñÔ∏è {stats.ferie}</span>
                                <span className="text-white text-sm">|</span>
                                <span className="text-white text-sm">ü§í {stats.malattia}</span>
                                <span className="text-white text-sm">|</span>
                                <span className="text-white text-sm">‚ö° {stats.straordinario}</span>
                                <span className="text-white text-sm">|</span>
                                <span className="text-white text-sm">üèÜ {achievements.length}</span>
                            </div>
                        )}

                        {/* Main Toolbar */}
                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl p-4 mb-4 shadow-xl`}>
                            <div className="flex flex-wrap gap-2 items-center justify-between">
                                <div className="flex flex-wrap gap-2">
                                    <button onClick={() => setShowShareModal(true)} className="bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">üì§ Condividi</button>
                                    <button onClick={() => { setShowChartModal(true); renderChart(); }} className="bg-purple-600 hover:bg-purple-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">üìä Grafici</button>
                                    <button onClick={() => setShowColleagueModal(true)} className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">üë• Colleghi</button>
                                    <button onClick={() => setShowCountdownModal(true)} className="bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">‚è∞ Timer</button>
                                    <button onClick={() => setShowBackupModal(true)} className="bg-indigo-600 hover:bg-indigo-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">üíæ Backup</button>
                                    <button onClick={() => setShowAchievements(true)} className="bg-orange-600 hover:bg-orange-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">üèÜ Trofei</button>
                                    <button onClick={exportToPDF} className="bg-pink-600 hover:bg-pink-700 text-white px-3 py-2 rounded-lg text-sm transition-colors">üì∏ Screenshot</button>
                                    <button 
                                        onClick={() => { setIsSelecting(!isSelecting); setSelectedRange({ start: null, end: null }); }}
                                        className={`${isSelecting ? 'bg-red-600' : 'bg-gray-600'} hover:bg-gray-700 text-white px-3 py-2 rounded-lg text-sm transition-colors`}
                                    >
                                        {isSelecting ? '‚ùå Annulla' : '‚úÇÔ∏è Selezione'}
                                    </button>
                                </div>
                                <div className="flex gap-2 items-center">
                                    <select value={filterType} onChange={(e) => setFilterType(e.target.value)} className="bg-gray-700 text-white px-2 py-2 rounded-lg text-sm">
                                        <option value="all">Tutti</option>
                                        <option value="modifiche">Modificati</option>
                                        <option value="note">Con Note</option>
                                        <option value="lavoro">Lavoro</option>
                                        <option value="riposo">Riposo</option>
                                    </select>
                                    <button onClick={() => setDarkMode(!darkMode)} className="bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-lg transition-colors">
                                        {darkMode ? '‚òÄÔ∏è' : 'üåô'}
                                    </button>
                                    <button onClick={() => setShowQuickStats(!showQuickStats)} className="bg-gray-700 hover:bg-gray-600 text-white px-3 py-2 rounded-lg transition-colors">
                                        {showQuickStats ? 'üìâ' : 'üìà'}
                                    </button>
                                </div>
                            </div>
                        </div>

                        {/* Month Selector */}
                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl p-4 mb-4 shadow-xl`}>
                            <div className="flex items-center justify-between mb-4">
                                <button onClick={() => setSelectedMonth(Math.max(0, selectedMonth - 1))} className="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">‚óÄ</button>
                                <h2 className={`text-2xl md:text-3xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{mesi[selectedMonth]} 2026</h2>
                                <button onClick={() => setSelectedMonth(Math.min(11, selectedMonth + 1))} className="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg">‚ñ∂</button>
                            </div>
                            <div className="flex flex-wrap justify-center gap-2">
                                {mesi.map((mese, idx) => (
                                    <button key={mese} onClick={() => setSelectedMonth(idx)} className={`px-3 py-1 rounded text-sm transition-all ${selectedMonth === idx ? 'bg-blue-600 text-white' : 'bg-gray-700 text-gray-300 hover:bg-gray-600'}`}>
                                        {mese.substring(0, 3)}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Calendar Grid */}
                        <div id="print-area" className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl p-4 md:p-6 shadow-xl`}>
                            <div className="grid grid-cols-7 gap-2 mb-4">
                                {giorniSettimana.map(giorno => (
                                    <div key={giorno} className={`text-center ${darkMode ? 'text-gray-400' : 'text-gray-600'} font-semibold py-2`}>{giorno}</div>
                                ))}
                            </div>
                            <div className="grid grid-cols-7 gap-2">
                                {renderCalendario()}
                            </div>
                        </div>

                        {/* Colleagues Comparison */}
                        {colleagues.length > 0 && (
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl p-4 mt-4 shadow-xl`}>
                                <h3 className="text-white font-semibold mb-3">üë• Turni Colleghi (oggi):</h3>
                                <div className="flex flex-wrap gap-3">
                                    {colleagues.map(col => {
                                        const turno = todayInfo ? getTurnoBase(todayInfo.mese, todayInfo.giorno, col.offset) : null;
                                        return (
                                            <div key={col.id} className={`${turno ? getTurnoClass(turno) : 'bg-gray-600'} px-4 py-2 rounded-lg`}>
                                                <p className="font-semibold">{col.name}</p>
                                                <p className="text-sm">{turno ? turno.tipo : 'N/A'}</p>
                                            </div>
                                        );
                                    })}
                                </div>
                            </div>
                        )}

                        {/* Legend */}
                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl p-4 mt-4 shadow-xl`}>
                            <div className="grid grid-cols-3 md:grid-cols-5 lg:grid-cols-10 gap-2 text-xs">
                                <div className="flex items-center gap-1"><div className="w-4 h-4 turno-mat rounded"></div><span className="text-gray-300">Mat</span></div>
                                <div className="flex items-center gap-1"><div className="w-4 h-4 turno-pom rounded"></div><span className="text-gray-300">Pom</span></div>
                                <div className="flex items-center gap-1"><div className="w-4 h-4 turno-not rounded"></div><span className="text-gray-300">Not</span></div>
                                <div className="flex items-center gap-1"><div className="w-4 h-4 turno-riposo rounded"></div><span className="text-gray-300">Rip</span></div>
                                <div className="flex items-center gap-1"><div className="w-4 h-4 turno-ferie rounded"></div><span className="text-gray-300">Fer</span></div>
                                <div className="flex items-center gap-1"><div className="w-4 h-4 turno-permesso rounded"></div><span className="text-gray-300">Per</span></div>
                                <div className="flex items-center gap-1"><div className="w-4 h-4 turno-malattia rounded"></div><span className="text-gray-300">Mal</span></div>
                                <div className="flex items-center gap-1"><div className="w-4 h-4 turno-straordinario rounded"></div><span className="text-gray-300">Str</span></div>
                                <div className="flex items-center gap-1"><div className="w-4 h-4 turno-formazione rounded"></div><span className="text-gray-300">For</span></div>
                                <div className="flex items-center gap-1"><div className="w-4 h-4 turno-trasferta rounded"></div><span className="text-gray-300">Tra</span></div>
                            </div>
                        </div>
                    </div>

                    {/* Modals */}
                    {showModal && selectedDay && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className="bg-gray-800 rounded-2xl p-6 max-w-md w-full shadow-2xl slide-in max-h-[90vh] overflow-y-auto">
                                <h3 className="text-xl font-bold text-white mb-4">‚úèÔ∏è {selectedDay.giorno} {mesi[selectedDay.mese]}</h3>
                                <p className="text-gray-400 text-sm mb-4">Base: {getTurnoBase(selectedDay.mese, selectedDay.giorno).tipo}</p>
                                <div className="grid grid-cols-2 gap-2 mb-4">
                                    {tipiModifica.map(tipo => (
                                        <button key={tipo.id} onClick={() => applicaModifica(tipo.id)} className={`${tipo.classe} text-white px-3 py-2 rounded-lg text-sm hover:scale-105 transition-transform`}>
                                            {tipo.emoji} {tipo.nome}
                                        </button>
                                    ))}
                                    <button onClick={() => applicaModifica('reset')} className="bg-gray-600 hover:bg-gray-700 text-white px-3 py-2 rounded-lg text-sm col-span-2">üîÑ Reset</button>
                                </div>
                                <textarea value={modalNote} onChange={(e) => setModalNote(e.target.value)} className="w-full px-3 py-2 bg-gray-700 text-white rounded-lg mb-2" rows="2" placeholder="Note..." />
                                <button onClick={salvaNote} className="w-full bg-green-600 hover:bg-green-700 text-white px-3 py-2 rounded-lg mb-2">üíæ Salva Nota</button>
                                <input type="text" value={currentReminder} onChange={(e) => setCurrentReminder(e.target.value)} className="w-full px-3 py-2 bg-gray-700 text-white rounded-lg mb-2" placeholder="Promemoria..." />
                                <button onClick={salvaReminder} className="w-full bg-yellow-600 hover:bg-yellow-700 text-white px-3 py-2 rounded-lg mb-4">‚è∞ Salva Promemoria</button>
                                <button onClick={() => setShowModal(false)} className="w-full bg-red-600 hover:bg-red-700 text-white px-3 py-2 rounded-lg">‚úñÔ∏è Chiudi</button>
                            </div>
                        </div>
                    )}

                    {showShareModal && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className="bg-gray-800 rounded-2xl p-6 max-w-md w-full shadow-2xl slide-in">
                                <h3 className="text-xl font-bold text-white mb-4">üì§ Condividi & Importa</h3>
                                <button onClick={generateShareCode} className="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg mb-4">üìã Genera Codice Condivisione</button>
                                {shareCode && <textarea value={shareCode} readOnly className="w-full px-3 py-2 bg-gray-700 text-white rounded-lg mb-4 text-xs" rows="3" />}
                                <hr className="border-gray-600 my-4" />
                                <input type="text" value={importCode} onChange={(e) => setImportCode(e.target.value)} className="w-full px-3 py-2 bg-gray-700 text-white rounded-lg mb-2" placeholder="Incolla codice..." />
                                <button onClick={importFromCode} className="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg mb-4">üì• Importa</button>
                                <button onClick={() => setShowShareModal(false)} className="w-full bg-gray-600 text-white px-3 py-2 rounded-lg">‚úñÔ∏è Chiudi</button>
                            </div>
                        </div>
                    )}

                    {showChartModal && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className="bg-gray-800 rounded-2xl p-6 max-w-2xl w-full shadow-2xl slide-in">
                                <h3 className="text-xl font-bold text-white mb-4">üìä Analisi Annuale</h3>
                                <canvas ref={chartRef}></canvas>
                                <button onClick={() => setShowChartModal(false)} className="w-full mt-4 bg-gray-600 text-white px-3 py-2 rounded-lg">‚úñÔ∏è Chiudi</button>
                            </div>
                        </div>
                    )}

                    {showColleagueModal && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className="bg-gray-800 rounded-2xl p-6 max-w-md w-full shadow-2xl slide-in">
                                <h3 className="text-xl font-bold text-white mb-4">üë• Gestisci Colleghi</h3>
                                <input type="text" value={newColleague.name} onChange={(e) => setNewColleague({...newColleague, name: e.target.value})} className="w-full px-3 py-2 bg-gray-700 text-white rounded-lg mb-2" placeholder="Nome collega..." />
                                <div className="flex gap-2 mb-4">
                                    <input type="number" value={newColleague.offset} onChange={(e) => setNewColleague({...newColleague, offset: parseInt(e.target.value)})} className="flex-1 px-3 py-2 bg-gray-700 text-white rounded-lg" placeholder="Offset ciclo (0-11)" min="0" max="11" />
                                    <button onClick={addColleague} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">‚ûï</button>
                                </div>
                                <div className="space-y-2 mb-4">
                                    {colleagues.map(col => (
                                        <div key={col.id} className="flex justify-between items-center bg-gray-700 px-3 py-2 rounded-lg">
                                            <span className="text-white">{col.name} (offset: {col.offset})</span>
                                            <button onClick={() => setColleagues(colleagues.filter(c => c.id !== col.id))} className="text-red-400 hover:text-red-300">üóëÔ∏è</button>
                                        </div>
                                    ))}
                                </div>
                                <button onClick={() => setShowColleagueModal(false)} className="w-full bg-gray-600 text-white px-3 py-2 rounded-lg">‚úñÔ∏è Chiudi</button>
                            </div>
                        </div>
                    )}

                    {showCountdownModal && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className="bg-gray-800 rounded-2xl p-6 max-w-md w-full shadow-2xl slide-in">
                                <h3 className="text-xl font-bold text-white mb-4">‚è∞ Countdown</h3>
                                <input type="datetime-local" value={countdownTarget} onChange={(e) => setCountdownTarget(e.target.value)} className="w-full px-3 py-2 bg-gray-700 text-white rounded-lg mb-4" />
                                <button onClick={() => { setCountdownTarget(''); setCountdown(null); }} className="w-full bg-red-600 text-white px-3 py-2 rounded-lg mb-2">üóëÔ∏è Cancella Timer</button>
                                <button onClick={() => setShowCountdownModal(false)} className="w-full bg-gray-600 text-white px-3 py-2 rounded-lg">‚úñÔ∏è Chiudi</button>
                            </div>
                        </div>
                    )}

                    {showBackupModal && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className="bg-gray-800 rounded-2xl p-6 max-w-md w-full shadow-2xl slide-in max-h-[90vh] overflow-y-auto">
                                <h3 className="text-xl font-bold text-white mb-4">üíæ Backup Manager</h3>
                                <button onClick={createBackup} className="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg mb-4">‚ûï Crea Nuovo Backup</button>
                                <div className="space-y-2 mb-4">
                                    {backupHistory.map(backup => (
                                        <div key={backup.id} className="bg-gray-700 px-3 py-2 rounded-lg">
                                            <p className="text-white text-sm">{backup.label}</p>
                                            <p className="text-gray-400 text-xs">{new Date(backup.date).toLocaleString('it-IT')}</p>
                                            <button onClick={() => restoreBackup(backup)} className="text-blue-400 hover:text-blue-300 text-sm mt-1">üîÑ Ripristina</button>
                                        </div>
                                    ))}
                                </div>
                                <button onClick={() => setShowBackupModal(false)} className="w-full bg-gray-600 text-white px-3 py-2 rounded-lg">‚úñÔ∏è Chiudi</button>
                            </div>
                        </div>
                    )}

                    {showAchievements && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className="bg-gray-800 rounded-2xl p-6 max-w-md w-full shadow-2xl slide-in">
                                <h3 className="text-xl font-bold text-white mb-4">üèÜ I Tuoi Trofei</h3>
                                <div className="space-y-3">
                                    <div className={`p-3 rounded-lg ${achievements.includes('vacanziero') ? 'bg-pink-600' : 'bg-gray-700 opacity-50'}`}>
                                        <p className="text-white font-semibold">üèñÔ∏è Vacanziero</p>
                                        <p className="text-sm text-gray-200">10+ giorni di ferie</p>
                                    </div>
                                    <div className={`p-3 rounded-lg ${achievements.includes('stakanovista') ? 'bg-orange-600' : 'bg-gray-700 opacity-50'}`}>
                                        <p className="text-white font-semibold">‚ö° Stakanovista</p>
                                        <p className="text-sm text-gray-200">20+ straordinari</p>
                                    </div>
                                    <div className={`p-3 rounded-lg ${achievements.includes('organizzato') ? 'bg-green-600' : 'bg-gray-700 opacity-50'}`}>
                                        <p className="text-white font-semibold">üìù Super Organizzato</p>
                                        <p className="text-sm text-gray-200">50+ note</p>
                                    </div>
                                    <div className={`p-3 rounded-lg ${achievements.includes('nottambulo') ? 'bg-purple-600' : 'bg-gray-700 opacity-50'}`}>
                                        <p className="text-white font-semibold">üåô Nottambulo</p>
                                        <p className="text-sm text-gray-200">30+ turni notte</p>
                                    </div>
                                </div>
                                <button onClick={() => setShowAchievements(false)} className="w-full mt-4 bg-gray-600 text-white px-3 py-2 rounded-lg">‚úñÔ∏è Chiudi</button>
                            </div>
                        </div>
                    )}

                    {showBulkModal && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className="bg-gray-800 rounded-2xl p-6 max-w-md w-full shadow-2xl slide-in">
                                <h3 className="text-xl font-bold text-white mb-4">‚úÇÔ∏è Modifica Multipla</h3>
                                <p className="text-gray-400 mb-4">Da {selectedRange.start?.giorno}/{selectedRange.start?.mese + 1} a {selectedRange.end?.giorno}/{selectedRange.end?.mese + 1}</p>
                                <div className="grid grid-cols-2 gap-2 mb-4">
                                    {tipiModifica.map(tipo => (
                                        <button key={tipo.id} onClick={() => applicaModificaBulk(tipo.id)} className={`${tipo.classe} text-white px-3 py-2 rounded-lg text-sm`}>
                                            {tipo.emoji} {tipo.nome}
                                        </button>
                                    ))}
                                    <button onClick={() => applicaModificaBulk('reset')} className="bg-gray-600 text-white px-3 py-2 rounded-lg text-sm col-span-2">üîÑ Reset Tutti</button>
                                </div>
                                <button onClick={() => { setShowBulkModal(false); setSelectedRange({ start: null, end: null }); }} className="w-full bg-red-600 text-white px-3 py-2 rounded-lg">‚úñÔ∏è Annulla</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
