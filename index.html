<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Turni 4¬™ Squadra 2026 - Pro Edition</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .turno-mat { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
        .turno-pom { background: linear-gradient(135deg, #60a5fa, #3b82f6); }
        .turno-not { background: linear-gradient(135deg, #a78bfa, #8b5cf6); }
        .turno-riposo { background: linear-gradient(135deg, #34d399, #10b981); }
        .turno-ferie { background: linear-gradient(135deg, #f472b6, #ec4899); }
        .turno-permesso { background: linear-gradient(135deg, #fcd34d, #fbbf24); }
        .turno-malattia { background: linear-gradient(135deg, #f87171, #ef4444); }
        .turno-straordinario { background: linear-gradient(135deg, #fb923c, #f97316); }
        .modal-backdrop { background: rgba(0,0,0,0.7); backdrop-filter: blur(4px); }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [selectedMonth, setSelectedMonth] = useState(new Date().getMonth());
            const [hoveredDay, setHoveredDay] = useState(null);
            const [modifiche, setModifiche] = useState(() => {
                const saved = localStorage.getItem('turni-modifiche-2026');
                return saved ? JSON.parse(saved) : {};
            });
            const [note, setNote] = useState(() => {
                const saved = localStorage.getItem('turni-note-2026');
                return saved ? JSON.parse(saved) : {};
            });
            const [showModal, setShowModal] = useState(false);
            const [selectedDay, setSelectedDay] = useState(null);
            const [modalNote, setModalNote] = useState('');
            const [showExportModal, setShowExportModal] = useState(false);
            const [showStatsModal, setShowStatsModal] = useState(false);
            const [notification, setNotification] = useState(null);
            const [searchDate, setSearchDate] = useState('');
            const [darkMode, setDarkMode] = useState(true);
            const [showHelp, setShowHelp] = useState(false);

            const mesi = ["Gennaio", "Febbraio", "Marzo", "Aprile", "Maggio", "Giugno", 
                         "Luglio", "Agosto", "Settembre", "Ottobre", "Novembre", "Dicembre"];
            const giorniMese = [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31];
            const giorniSettimana = ["Lun", "Mar", "Mer", "Gio", "Ven", "Sab", "Dom"];
            const primoGiornoMese = [3, 6, 6, 2, 4, 0, 2, 5, 1, 3, 6, 1];

            const tipiModifica = [
                { id: 'ferie', nome: 'Ferie', emoji: 'üèñÔ∏è', classe: 'turno-ferie' },
                { id: 'permesso', nome: 'Permesso', emoji: 'üìã', classe: 'turno-permesso' },
                { id: 'malattia', nome: 'Malattia', emoji: 'ü§í', classe: 'turno-malattia' },
                { id: 'straordinario', nome: 'Straordinario', emoji: '‚ö°', classe: 'turno-straordinario' },
            ];

            const ciclo = [
                { tipo: "Pom", orario: "14:00-22:00", lavoro: true },
                { tipo: "Pom", orario: "14:00-22:00", lavoro: true },
                { tipo: "Pom", orario: "14:00-22:00", lavoro: true },
                { tipo: "R", orario: "Riposo", lavoro: false },
                { tipo: "Mat", orario: "06:00-14:00", lavoro: true },
                { tipo: "Mat", orario: "06:00-14:00", lavoro: true },
                { tipo: "Mat", orario: "06:00-14:00", lavoro: true },
                { tipo: "R", orario: "Riposo", lavoro: false },
                { tipo: "Not", orario: "22:00-06:00", lavoro: true },
                { tipo: "Not", orario: "22:00-06:00", lavoro: true },
                { tipo: "Not", orario: "22:00-06:00", lavoro: true },
                { tipo: "R", orario: "Riposo", lavoro: false },
            ];

            useEffect(() => {
                localStorage.setItem('turni-modifiche-2026', JSON.stringify(modifiche));
            }, [modifiche]);

            useEffect(() => {
                localStorage.setItem('turni-note-2026', JSON.stringify(note));
            }, [note]);

            const showNotification = (message, type = 'success') => {
                setNotification({ message, type });
                setTimeout(() => setNotification(null), 3000);
            };

            const getTurnoBase = (meseIdx, giorno) => {
                let giornoAnno = giorno;
                for (let i = 0; i < meseIdx; i++) {
                    giornoAnno += giorniMese[i];
                }
                const indiceCiclo = (giornoAnno - 1 + 3) % 12;
                return ciclo[indiceCiclo];
            };

            const getChiaveGiorno = (meseIdx, giorno) => `${meseIdx}-${giorno}`;

            const getTurnoEffettivo = (meseIdx, giorno) => {
                const chiave = getChiaveGiorno(meseIdx, giorno);
                const modifica = modifiche[chiave];
                if (modifica) {
                    return { ...getTurnoBase(meseIdx, giorno), modifica };
                }
                return getTurnoBase(meseIdx, giorno);
            };

            const getTurnoClass = (turno) => {
                if (turno.modifica) {
                    const tipo = tipiModifica.find(t => t.id === turno.modifica.tipo);
                    return tipo ? `${tipo.classe} text-white` : 'bg-gray-500 text-white';
                }
                switch(turno.tipo) {
                    case "Mat": return "turno-mat text-white";
                    case "Pom": return "turno-pom text-white";
                    case "Not": return "turno-not text-white";
                    case "R": return "turno-riposo text-white";
                    default: return "bg-gray-200";
                }
            };

            const apriModale = (meseIdx, giorno) => {
                setSelectedDay({ mese: meseIdx, giorno });
                const chiave = getChiaveGiorno(meseIdx, giorno);
                setModalNote(note[chiave] || '');
                setShowModal(true);
            };

            const applicaModifica = (tipoModifica) => {
                if (!selectedDay) return;
                const chiave = getChiaveGiorno(selectedDay.mese, selectedDay.giorno);
                
                if (tipoModifica === 'reset') {
                    const nuoveModifiche = { ...modifiche };
                    delete nuoveModifiche[chiave];
                    setModifiche(nuoveModifiche);
                    showNotification('üîÑ Turno ripristinato!');
                } else {
                    setModifiche({
                        ...modifiche,
                        [chiave]: { tipo: tipoModifica, data: new Date().toISOString() }
                    });
                    const tipo = tipiModifica.find(t => t.id === tipoModifica);
                    showNotification(`${tipo.emoji} ${tipo.nome} applicato!`);
                }
            };

            const salvaNote = () => {
                if (!selectedDay) return;
                const chiave = getChiaveGiorno(selectedDay.mese, selectedDay.giorno);
                if (modalNote.trim()) {
                    setNote({ ...note, [chiave]: modalNote });
                    showNotification('üìù Nota salvata!');
                } else {
                    const nuoveNote = { ...note };
                    delete nuoveNote[chiave];
                    setNote(nuoveNote);
                }
            };

            const calcolaStatistiche = () => {
                let stats = { 
                    Mat: 0, Pom: 0, Not: 0, R: 0, totale: 0,
                    ferie: 0, permesso: 0, malattia: 0, straordinario: 0,
                    oreStimate: 0
                };
                
                for (let m = 0; m < 12; m++) {
                    for (let g = 1; g <= giorniMese[m]; g++) {
                        const turno = getTurnoEffettivo(m, g);
                        
                        if (turno.modifica) {
                            stats[turno.modifica.tipo]++;
                            if (turno.modifica.tipo === 'straordinario') {
                                stats.oreStimate += 8;
                            }
                        } else {
                            stats[turno.tipo]++;
                            if (turno.lavoro) {
                                stats.totale++;
                                stats.oreStimate += 8;
                            }
                        }
                    }
                }
                return stats;
            };

            const exportData = (format) => {
                const stats = calcolaStatistiche();
                let content = '';
                
                if (format === 'json') {
                    const data = {
                        anno: 2026,
                        squadra: '4¬™ Squadra',
                        statistiche: stats,
                        modifiche: modifiche,
                        note: note,
                        esportato: new Date().toISOString()
                    };
                    content = JSON.stringify(data, null, 2);
                    downloadFile(content, 'turni-2026.json', 'application/json');
                } else if (format === 'csv') {
                    content = 'Data,Giorno Settimana,Turno Base,Modifica,Note\n';
                    for (let m = 0; m < 12; m++) {
                        for (let g = 1; g <= giorniMese[m]; g++) {
                            const turno = getTurnoEffettivo(m, g);
                            const chiave = getChiaveGiorno(m, g);
                            const dataStr = `${g.toString().padStart(2, '0')}/${(m+1).toString().padStart(2, '0')}/2026`;
                            const giornoSett = getGiornoSettimana(m, g);
                            const modStr = turno.modifica ? turno.modifica.tipo : '';
                            const notaStr = (note[chiave] || '').replace(/"/g, '""');
                            content += `${dataStr},${giornoSett},${turno.tipo},${modStr},"${notaStr}"\n`;
                        }
                    }
                    downloadFile(content, 'turni-2026.csv', 'text/csv');
                } else if (format === 'ical') {
                    content = generateICalendar();
                    downloadFile(content, 'turni-2026.ics', 'text/calendar');
                }
                
                showNotification(`üìÅ Esportato in ${format.toUpperCase()}!`);
                setShowExportModal(false);
            };

            const generateICalendar = () => {
                let ical = `BEGIN:VCALENDAR
VERSION:2.0
PRODID:-//Turni 4a Squadra//IT
CALSCALE:GREGORIAN
METHOD:PUBLISH
X-WR-CALNAME:Turni 4¬™ Squadra 2026
`;
                for (let m = 0; m < 12; m++) {
                    for (let g = 1; g <= giorniMese[m]; g++) {
                        const turno = getTurnoEffettivo(m, g);
                        if (turno.lavoro || turno.modifica) {
                            const dateStr = `2026${(m+1).toString().padStart(2, '0')}${g.toString().padStart(2, '0')}`;
                            const chiave = getChiaveGiorno(m, g);
                            let summary = turno.modifica 
                                ? tipiModifica.find(t => t.id === turno.modifica.tipo)?.nome || turno.tipo
                                : `Turno ${turno.tipo}`;
                            let description = turno.orario;
                            if (note[chiave]) description += ` - ${note[chiave]}`;
                            
                            ical += `BEGIN:VEVENT
DTSTART;VALUE=DATE:${dateStr}
DTEND;VALUE=DATE:${dateStr}
SUMMARY:${summary}
DESCRIPTION:${description}
UID:${dateStr}-turno@4squadra
END:VEVENT
`;
                        }
                    }
                }
                ical += 'END:VCALENDAR';
                return ical;
            };

            const downloadFile = (content, filename, mimeType) => {
                const blob = new Blob([content], { type: mimeType });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                a.click();
                URL.revokeObjectURL(url);
            };

            const getGiornoSettimana = (meseIdx, giorno) => {
                const primo = primoGiornoMese[meseIdx];
                const idx = (primo + giorno - 1) % 7;
                return giorniSettimana[idx];
            };

            const cercaData = () => {
                if (!searchDate) return;
                const [anno, mese, giorno] = searchDate.split('-').map(Number);
                if (anno === 2026 && mese >= 1 && mese <= 12) {
                    setSelectedMonth(mese - 1);
                    setTimeout(() => {
                        setHoveredDay(giorno);
                        showNotification(`üìç Trovato: ${giorno} ${mesi[mese-1]} 2026`);
                    }, 300);
                }
            };

            const stats = calcolaStatistiche();

            const renderCalendario = () => {
                const giorni = [];
                const primoGiorno = primoGiornoMese[selectedMonth];
                const numGiorni = giorniMese[selectedMonth];

                for (let i = 0; i < primoGiorno; i++) {
                    giorni.push(<div key={`empty-${i}`} className="h-20 md:h-24"></div>);
                }

                for (let giorno = 1; giorno <= numGiorni; giorno++) {
                    const turno = getTurnoEffettivo(selectedMonth, giorno);
                    const chiave = getChiaveGiorno(selectedMonth, giorno);
                    const hasNote = note[chiave];
                    const hasModifica = turno.modifica;
                    const isHovered = hoveredDay === giorno;
                    
                    giorni.push(
                        <div
                            key={giorno}
                            onClick={() => apriModale(selectedMonth, giorno)}
                            className={`h-20 md:h-24 rounded-lg ${getTurnoClass(turno)} 
                                       flex flex-col items-center justify-center cursor-pointer relative
                                       transform transition-all duration-200 hover:scale-105 hover:shadow-xl
                                       ${isHovered ? 'ring-4 ring-white ring-opacity-70 scale-110' : ''}
                                       ${hasModifica ? 'ring-2 ring-yellow-300' : ''}`}
                        >
                            {hasNote && (
                                <div className="absolute top-1 right-1 text-xs">üìù</div>
                            )}
                            {hasModifica && (
                                <div className="absolute top-1 left-1 text-xs">
                                    {tipiModifica.find(t => t.id === hasModifica.tipo)?.emoji}
                                </div>
                            )}
                            <span className="text-lg font-bold">{giorno}</span>
                            <span className="text-sm font-semibold">
                                {hasModifica 
                                    ? tipiModifica.find(t => t.id === hasModifica.tipo)?.nome.substring(0, 3)
                                    : turno.tipo}
                            </span>
                            {isHovered && (
                                <span className="text-xs mt-1 opacity-90 text-center px-1">
                                    {hasModifica 
                                        ? tipiModifica.find(t => t.id === hasModifica.tipo)?.nome
                                        : turno.orario}
                                </span>
                            )}
                        </div>
                    );
                }

                return giorni;
            };

            return (
                <div className={`min-h-screen ${darkMode ? 'bg-gradient-to-br from-gray-900 to-gray-800' : 'bg-gradient-to-br from-blue-50 to-indigo-100'} p-4 md:p-8 transition-colors duration-500`}>
                    {notification && (
                        <div className={`fixed top-4 right-4 z-50 px-6 py-3 rounded-lg shadow-lg 
                                        ${notification.type === 'success' ? 'bg-green-500' : 'bg-red-500'} text-white font-semibold`}>
                            {notification.message}
                        </div>
                    )}

                    <div className="max-w-7xl mx-auto">
                        <div className="text-center mb-6">
                            <h1 className={`text-4xl md:text-5xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'} mb-2`}>
                                üóìÔ∏è Turni 4¬™ Squadra 2026
                                <span className="text-sm ml-2 bg-gradient-to-r from-pink-500 to-purple-500 text-white px-2 py-1 rounded-full">PRO</span>
                            </h1>
                            <p className={`${darkMode ? 'text-gray-400' : 'text-gray-600'}`}>
                                Clicca su un giorno per modificarlo ‚Ä¢ Gestisci ferie, permessi e note
                            </p>
                        </div>

                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl p-4 mb-6 shadow-xl flex flex-wrap gap-3 items-center justify-between`}>
                            <div className="flex gap-2">
                                <button onClick={() => setShowExportModal(true)} className="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    üì• Esporta
                                </button>
                                <button onClick={() => setShowStatsModal(true)} className="bg-purple-600 hover:bg-purple-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    üìä Statistiche
                                </button>
                                <button onClick={() => setShowHelp(true)} className="bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg transition-colors">
                                    ‚ùì
                                </button>
                            </div>
                            <div className="flex gap-2 items-center">
                                <input type="date" value={searchDate} onChange={(e) => setSearchDate(e.target.value)} min="2026-01-01" max="2026-12-31" className="bg-gray-700 text-white px-3 py-2 rounded-lg" />
                                <button onClick={cercaData} className="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg transition-colors">üîç</button>
                                <button onClick={() => setDarkMode(!darkMode)} className="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg transition-colors">
                                    {darkMode ? '‚òÄÔ∏è' : 'üåô'}
                                </button>
                            </div>
                        </div>

                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl p-4 mb-6 shadow-xl`}>
                            <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                                <div className="bg-gradient-to-r from-blue-600 to-blue-700 rounded-lg p-3 text-center">
                                    <p className="text-white text-xs opacity-80">Giorni Lavoro</p>
                                    <p className="text-2xl font-bold text-white">{stats.totale}</p>
                                </div>
                                <div className="turno-ferie rounded-lg p-3 text-center">
                                    <p className="text-white text-xs opacity-80">Ferie</p>
                                    <p className="text-2xl font-bold text-white">{stats.ferie}</p>
                                </div>
                                <div className="turno-permesso rounded-lg p-3 text-center">
                                    <p className="text-white text-xs opacity-80">Permessi</p>
                                    <p className="text-2xl font-bold text-white">{stats.permesso}</p>
                                </div>
                                <div className="turno-malattia rounded-lg p-3 text-center">
                                    <p className="text-white text-xs opacity-80">Malattia</p>
                                    <p className="text-2xl font-bold text-white">{stats.malattia}</p>
                                </div>
                                <div className="turno-straordinario rounded-lg p-3 text-center">
                                    <p className="text-white text-xs opacity-80">Straordinari</p>
                                    <p className="text-2xl font-bold text-white">{stats.straordinario}</p>
                                </div>
                            </div>
                        </div>

                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl p-4 mb-6 shadow-xl`}>
                            <div className="flex items-center justify-between mb-4">
                                <button onClick={() => setSelectedMonth(Math.max(0, selectedMonth - 1))} className={`${darkMode ? 'bg-gray-700 hover:bg-gray-600 text-white' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'} px-4 py-2 rounded-lg transition-colors`} disabled={selectedMonth === 0}>
                                    ‚óÄ Prec
                                </button>
                                <h2 className={`text-2xl md:text-3xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>
                                    {mesi[selectedMonth]} 2026
                                </h2>
                                <button onClick={() => setSelectedMonth(Math.min(11, selectedMonth + 1))} className={`${darkMode ? 'bg-gray-700 hover:bg-gray-600 text-white' : 'bg-gray-200 hover:bg-gray-300 text-gray-800'} px-4 py-2 rounded-lg transition-colors`} disabled={selectedMonth === 11}>
                                    Succ ‚ñ∂
                                </button>
                            </div>
                            <div className="flex flex-wrap justify-center gap-2">
                                {mesi.map((mese, idx) => (
                                    <button key={mese} onClick={() => setSelectedMonth(idx)} className={`px-3 py-1 rounded text-sm transition-all transform hover:scale-110 ${selectedMonth === idx ? 'bg-blue-600 text-white shadow-lg' : `${darkMode ? 'bg-gray-700 text-gray-300 hover:bg-gray-600' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'}`}`}>
                                        {mese.substring(0, 3)}
                                    </button>
                                ))}
                            </div>
                        </div>

                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl p-4 md:p-6 shadow-xl`}>
                            <div className="grid grid-cols-7 gap-2 mb-4">
                                {giorniSettimana.map(giorno => (
                                    <div key={giorno} className={`text-center ${darkMode ? 'text-gray-400' : 'text-gray-600'} font-semibold py-2`}>
                                        {giorno}
                                    </div>
                                ))}
                            </div>
                            <div className="grid grid-cols-7 gap-2">
                                {renderCalendario()}
                            </div>
                        </div>

                        <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-xl p-4 mt-6 shadow-xl`}>
                            <h3 className={`${darkMode ? 'text-white' : 'text-gray-800'} font-semibold mb-3`}>üìã Legenda:</h3>
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-8 gap-3">
                                <div className="flex items-center gap-2"><div className="w-6 h-6 turno-mat rounded"></div><span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Mattina</span></div>
                                <div className="flex items-center gap-2"><div className="w-6 h-6 turno-pom rounded"></div><span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Pomeriggio</span></div>
                                <div className="flex items-center gap-2"><div className="w-6 h-6 turno-not rounded"></div><span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Notte</span></div>
                                <div className="flex items-center gap-2"><div className="w-6 h-6 turno-riposo rounded"></div><span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Riposo</span></div>
                                <div className="flex items-center gap-2"><div className="w-6 h-6 turno-ferie rounded"></div><span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Ferie</span></div>
                                <div className="flex items-center gap-2"><div className="w-6 h-6 turno-permesso rounded"></div><span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Permesso</span></div>
                                <div className="flex items-center gap-2"><div className="w-6 h-6 turno-malattia rounded"></div><span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Malattia</span></div>
                                <div className="flex items-center gap-2"><div className="w-6 h-6 turno-straordinario rounded"></div><span className={`text-sm ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>Straordinario</span></div>
                            </div>
                        </div>
                    </div>

                    {showModal && selectedDay && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl p-6 max-w-md w-full shadow-2xl`}>
                                <h3 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'} mb-4`}>
                                    ‚úèÔ∏è Modifica {selectedDay.giorno} {mesi[selectedDay.mese]}
                                </h3>
                                <p className={`text-sm ${darkMode ? 'text-gray-400' : 'text-gray-600'} mb-4`}>Turno base: {getTurnoBase(selectedDay.mese, selectedDay.giorno).tipo} ({getTurnoBase(selectedDay.mese, selectedDay.giorno).orario})</p>
                                <div className="grid grid-cols-2 gap-3 mb-4">
                                    {tipiModifica.map(tipo => (
                                        <button key={tipo.id} onClick={() => applicaModifica(tipo.id)} className={`${tipo.classe} text-white px-4 py-3 rounded-lg transition-transform hover:scale-105 flex items-center justify-center gap-2`}>
                                            <span>{tipo.emoji}</span><span>{tipo.nome}</span>
                                        </button>
                                    ))}
                                    <button onClick={() => applicaModifica('reset')} className="bg-gray-600 hover:bg-gray-700 text-white px-4 py-3 rounded-lg transition-transform hover:scale-105 col-span-2">
                                        üîÑ Ripristina Turno Base
                                    </button>
                                </div>
                                <div className="mb-4">
                                    <label className={`block text-sm font-medium ${darkMode ? 'text-gray-300' : 'text-gray-700'} mb-2`}>üìù Note personali:</label>
                                    <textarea value={modalNote} onChange={(e) => setModalNote(e.target.value)} className={`w-full px-3 py-2 ${darkMode ? 'bg-gray-700 text-white' : 'bg-gray-100 text-gray-800'} rounded-lg focus:ring-2 focus:ring-blue-500`} rows="3" placeholder="Aggiungi note, promemoria..." />
                                    <button onClick={salvaNote} className="mt-2 bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg w-full">üíæ Salva Nota</button>
                                </div>
                                <button onClick={() => setShowModal(false)} className="w-full bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">‚úñÔ∏è Chiudi</button>
                            </div>
                        </div>
                    )}

                    {showExportModal && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl p-6 max-w-md w-full shadow-2xl`}>
                                <h3 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'} mb-4`}>üì• Esporta Dati</h3>
                                <div className="space-y-3">
                                    <button onClick={() => exportData('csv')} className="w-full bg-green-600 hover:bg-green-700 text-white px-4 py-3 rounded-lg">üìä Esporta CSV (Excel)</button>
                                    <button onClick={() => exportData('json')} className="w-full bg-blue-600 hover:bg-blue-700 text-white px-4 py-3 rounded-lg">üíæ Esporta JSON (Backup)</button>
                                    <button onClick={() => exportData('ical')} className="w-full bg-purple-600 hover:bg-purple-700 text-white px-4 py-3 rounded-lg">üìÖ Esporta iCalendar</button>
                                </div>
                                <button onClick={() => setShowExportModal(false)} className="w-full mt-4 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">‚úñÔ∏è Chiudi</button>
                            </div>
                        </div>
                    )}

                    {showStatsModal && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl p-6 max-w-lg w-full shadow-2xl max-h-[90vh] overflow-y-auto`}>
                                <h3 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'} mb-4`}>üìä Statistiche Annuali 2026</h3>
                                <div className="space-y-3">
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-100'} p-3 rounded-lg flex justify-between`}><span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>‚òÄÔ∏è Turni Mattina</span><span className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.Mat}</span></div>
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-100'} p-3 rounded-lg flex justify-between`}><span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>üåÖ Turni Pomeriggio</span><span className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.Pom}</span></div>
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-100'} p-3 rounded-lg flex justify-between`}><span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>üåô Turni Notte</span><span className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.Not}</span></div>
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-100'} p-3 rounded-lg flex justify-between`}><span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>üò¥ Giorni Riposo</span><span className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.R}</span></div>
                                    <hr className={darkMode ? 'border-gray-600' : 'border-gray-300'} />
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-100'} p-3 rounded-lg flex justify-between`}><span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>üèñÔ∏è Ferie</span><span className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.ferie}</span></div>
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-100'} p-3 rounded-lg flex justify-between`}><span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>üìã Permessi</span><span className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.permesso}</span></div>
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-100'} p-3 rounded-lg flex justify-between`}><span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>ü§í Malattia</span><span className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.malattia}</span></div>
                                    <div className={`${darkMode ? 'bg-gray-700' : 'bg-gray-100'} p-3 rounded-lg flex justify-between`}><span className={darkMode ? 'text-gray-300' : 'text-gray-700'}>‚ö° Straordinari</span><span className={`font-bold ${darkMode ? 'text-white' : 'text-gray-800'}`}>{stats.straordinario}</span></div>
                                    <hr className={darkMode ? 'border-gray-600' : 'border-gray-300'} />
                                    <div className="bg-blue-600 p-3 rounded-lg flex justify-between text-white"><span>üíº Totale Giorni Lavoro</span><span className="font-bold">{stats.totale}</span></div>
                                    <div className="bg-green-600 p-3 rounded-lg flex justify-between text-white"><span>‚è∞ Ore Stimate</span><span className="font-bold">{stats.oreStimate}h</span></div>
                                </div>
                                <button onClick={() => setShowStatsModal(false)} className="w-full mt-4 bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded-lg">‚úñÔ∏è Chiudi</button>
                            </div>
                        </div>
                    )}

                    {showHelp && (
                        <div className="fixed inset-0 modal-backdrop flex items-center justify-center z-50 p-4">
                            <div className={`${darkMode ? 'bg-gray-800' : 'bg-white'} rounded-2xl p-6 max-w-lg w-full shadow-2xl`}>
                                <h3 className={`text-xl font-bold ${darkMode ? 'text-white' : 'text-gray-800'} mb-4`}>‚ùì Come Usare l'App</h3>
                                <div className={`space-y-3 ${darkMode ? 'text-gray-300' : 'text-gray-700'}`}>
                                    <p>üñ±Ô∏è <strong>Clicca su un giorno</strong> per modificarlo</p>
                                    <p>üèñÔ∏è <strong>Aggiungi ferie, permessi, malattia</strong> o straordinari</p>
                                    <p>üìù <strong>Scrivi note personali</strong> per ogni giorno</p>
                                    <p>üì• <strong>Esporta i dati</strong> in CSV, JSON o iCalendar</p>
                                    <p>üîç <strong>Cerca una data</strong> specifica</p>
                                    <p>üåô <strong>Cambia tema</strong> chiaro/scuro</p>
                                    <p>üíæ <strong>I dati si salvano</strong> automaticamente nel browser</p>
                                    <p className="text-yellow-500 font-semibold mt-4">‚ö†Ô∏è I dati sono salvati solo su questo dispositivo/browser!</p>
                                </div>
                                <button onClick={() => setShowHelp(false)} className="w-full mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">üëç Ho Capito!</button>
                            </div>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
